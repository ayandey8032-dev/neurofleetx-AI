<%- include('partials/header',{ isDashboard: false}); -%>

<style>
  select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }

  #snackbar {
    visibility: hidden;
    min-width: 250px;
    background-color: #4caf50;
    color: #fff;
    text-align: center;
    border-radius: 4px;
    padding: 16px;
    position: fixed;
    z-index: 1;
    left: 50%;
    transform: translateX(-50%);
    bottom: 30px;
    font-size: 17px;
    opacity: 0;
    transition: opacity 0.5s ease-in-out, visibility 0.5s;
  }
  #snackbar.show {
    visibility: visible;
    opacity: 1;
  }
</style>

<form>
  <h2>Signup</h2>

  <label for="username">Username</label>
  <input type="text" name="username" required />
  <div class="username error"></div>

  <label for="email">Email</label>
  <input type="email" name="email" required />
  <div class="email error"></div>

  <label for="password">Password</label>
  <input type="password" name="password" required />
  <div class="password error"></div>

  <label for="confirmPassword">Confirm Password</label>
  <input type="password" name="confirmPassword" required />
  <div class="confirmPassword error"></div>

  <label for="role">Roles</label>
  <select name="role" required>
    <option value="" disabled selected>Select a role</option>
    <option value="admin">Admin</option>
    <option value="customer">Customer</option>
    <option value="seller">Seller</option>
  </select>
  <div class="role error"></div>

  <button class="btn" type="submit">Sign up</button>
</form>

<div id="snackbar">Signup successful. Now you can proceed to login.</div>

<script>
  const form = document.querySelector("form");
  const usernameError = document.querySelector(".username.error");
  const emailError = document.querySelector(".email.error");
  const passwordError = document.querySelector(".password.error");
  const confirmPasswordError = document.querySelector(".confirmPassword.error");
  const roleError = document.querySelector(".role.error");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Reset errors
    usernameError.textContent = "";
    emailError.textContent = "";
    passwordError.textContent = "";
    confirmPasswordError.textContent = "";
    roleError.textContent = "";

    // Get values
    const username = form.username.value;
    const email = form.email.value;
    const password = form.password.value;
    const confirmPassword = form.confirmPassword.value;
    const role = form.role.value;

    // Client-side validation
    if (password !== confirmPassword) {
      confirmPasswordError.textContent = "Passwords do not match.";
      return;
    }

    try {
      const res = await fetch("/signup", {
        method: "POST",
        body: JSON.stringify({ username, email, password, role }),
        headers: { "Content-Type": "application/json" },
      });

      const data = await res.json();
      console.log("data is", data);

      if (data.errors) {
        usernameError.textContent = data.errors.username || "";
        emailError.textContent = data.errors.email || "";
        passwordError.textContent = data.errors.password || "";
        roleError.textContent = data.errors.role || "";
      }

      if (data.user) {
        showSnackbar();
        form.reset();
      }
    } catch (error) {
      console.error("Signup error:", error);
    }
  });

  function showSnackbar() {
    const snackbar = document.getElementById("snackbar");
    snackbar.classList.add("show");
    setTimeout(() => {
      snackbar.classList.remove("show");
    }, 3000); // 3 seconds
  }
</script>
